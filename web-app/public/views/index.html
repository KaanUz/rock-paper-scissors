<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Rock Paper Scissors</title>
        <link rel="stylesheet" href="public/css/style.css" type="text/css">
    </head>
    <body>
        <header>
            <h1>Rock Paper Scissors</h1>
        </header>
        
        <div class="choices">
            <div class="ai-choice" id="ai_choice">
                <img src="public/images/rock.png" style="visibility: hidden;" alt=""> 
            </div>
        </div>

        
        <div class="score-board">
            <div id="usr" class="badge">You</div>
            <div id="ai" class="badge">AI</div>
            <span id="usr_score" > 0 </span> : <span id="ai_score" > 0 </span>
        </div>
        

        <div id="message" class="res"></div>

        <div class="choices">
            <div id="rock" class="choice" value="rock">
                <img type="image" src="public/images/rock.png">
            </div>
            <div id="paper" class="choice" value="paper">
                <img type="image" src="public/images/paper.png">
            </div>
            <div id="scissors" class="choice" value="scissors">
                <img type="image" src="public/images/scissors.png">
            </div>
        </div>

        <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            let usrScore        = 0;
            let aiScore         = 0;
            var socket = io('http://localhost:9000');

            socket.on('connect', function () {
                $('#message').empty();
                $('#message').append($('<p>').text("Choose your weapon!"));
            });
            
            var choices = document.getElementsByClassName('choice');
            for (let j = 0; j < choices.length; j++) {
                let choice = choices[j];
                choice.addEventListener('click', function() {
                    socket.emit('user choice', 
                        choice.getAttribute('value')
                    );
                });
            }

            socket.on('game result', function(data) {
                $('#message').empty();
                $('#message').append($('<p>').text(data.msg));
                    
                aiChoice_img = $('#ai_choice > img')
                aiChoice_img.removeAttr('style');
                $('#ai_choice > img').attr("src", "public/images/" + data.aiChoice + ".png")

                if (data.res == null) {
                    $(`#${data.usrChoice}`).addClass('gray-glow');
                    $(`#ai_choice`).addClass('gray-glow');
                    setTimeout( function() {
                        $(`#${data.usrChoice}`).removeClass('gray-glow');
                        $(`#ai_choice`).removeClass('gray-glow');
                    }, 500); 
                } else if (data.res) {
                    $(`#usr_score`).html(++usrScore);
                    $(`#${data.usrChoice}`).addClass('green-glow');
                    $(`#ai_choice`).addClass('red-glow');
                    setTimeout( function() {
                        $(`#${data.usrChoice}`).removeClass('green-glow');
                        $(`#ai_choice`).removeClass('red-glow');
                    }, 500); 
                } else {
                    $(`#ai_score`).html(++aiScore);
                    $(`#${data.usrChoice}`).addClass('red-glow');
                    $(`#ai_choice`).addClass('green-glow');
                    setTimeout( function() {
                        $(`#${data.usrChoice}`).removeClass('red-glow');
                        $(`#ai_choice`).removeClass('green-glow');
                    }, 500); 
                }
                
            });
        </script>

    </body>
</html>